<!-- templates/gallery/gallery.html -->
{% load static %}
{% if photos %}
<div class="gallery" data-gallery>
    <div class="gallery-main">
        {% for photo in photos %}
        <div class="slide" {% if forloop.first %}style="display: block"{% else %}style="display: none"{% endif %}>
            <img src="{{ photo.image.url }}" alt="">
        </div>
        {% endfor %}
    </div>
    
    {% if photos|length > 1 %}
    <button class="gallery-btn prev" onclick="changeSlide(this, -1)">‹</button>
    <button class="gallery-btn next" onclick="changeSlide(this, 1)">›</button>
    
    <div class="gallery-dots">
        {% for photo in photos %}
        <span class="dot {% if forloop.first %}active{% endif %}" onclick="currentSlide(this, {{ forloop.counter }})"></span>
        {% endfor %}
    </div>
    {% endif %}
</div>

<style>
.gallery {
    position: relative;
    max-width: 600px;
    margin: 0 auto;
    background: #000;
}

.gallery-main {
    position: relative;
    width: 100%;
    height: 400px;
}

.slide {
    width: 100%;
    height: 100%;
}

.slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.gallery-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.8);
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    font-size: 20px;
    z-index: 10;
}

.prev { left: 10px; }
.next { right: 10px; }

.gallery-btn:hover {
    background: rgba(255,255,255,1);
}

.gallery-dots {
    text-align: center;
    padding: 10px 0;
}

.dot {
    height: 12px;
    width: 12px;
    margin: 0 5px;
    background-color: #bbb;
    border-radius: 50%;
    display: inline-block;
    cursor: pointer;
}

.dot.active, .dot:hover {
    background-color: #717171;
}
</style>

<script>
function changeSlide(btn, direction) {
    const gallery = btn.closest('[data-gallery]');
    const slides = gallery.querySelectorAll('.slide');
    const dots = gallery.querySelectorAll('.dot');
    
    let current = 0;
    slides.forEach((slide, index) => {
        if (slide.style.display === 'block') {
            current = index;
        }
    });
    
    let next = current + direction;
    if (next >= slides.length) next = 0;
    if (next < 0) next = slides.length - 1;
    
    slides[current].style.display = 'none';
    slides[next].style.display = 'block';
    
    dots[current].classList.remove('active');
    dots[next].classList.add('active');
}

function currentSlide(dot, n) {
    const gallery = dot.closest('[data-gallery]');
    const slides = gallery.querySelectorAll('.slide');
    const dots = gallery.querySelectorAll('.dot');
    
    slides.forEach(slide => slide.style.display = 'none');
    dots.forEach(d => d.classList.remove('active'));
    
    slides[n-1].style.display = 'block';
    dot.classList.add('active');
}
</script>

{% endif %}